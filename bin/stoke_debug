#!/bin/bash

# http://stackoverflow.com/questions/4774054/
#   reliable-way-for-a-bash-script-to-get-the-full-path-to-itself

pushd `dirname $0` > /dev/null
HERE=`pwd`
popd > /dev/null

if [ ! -f $HERE/stoke_cfg ] || [ ! -f $HERE/stoke_cost ] || 
   [ ! -f $HERE/stoke_simulate ] || [ ! -f $HERE/stoke_validate ]
then
	echo "Fatal Error: Failed to locate one or more STOKE components!"
	exit 1
fi

if [ $# -eq 0 ] 
then
	echo "Type 'stoke_debug --help' for usage."
	exit 1
fi

SCMD=$1
shift

if [ "$SCMD" == "--help" ] || [ "$SCMD" == "-h" ]
then
	echo "Usage: stoke_debug <subcommand> [options]"
	echo "Type 'stoke_debug <subcommand> --help' for help on a specific subcommand."
	echo ""
	echo "  cfg        generate the control flow graph for a function"
	echo "  cost       evaluate a function using a STOKE cost function"
	echo "  simulate   run a function"
	echo "  validate   formally check the equivalence of two functions"
	echo ""
	exit 0
elif [ "$SCMD" == "cfg" ]
then
	$DIR/stoke_cfg $@
elif [ "$SCMD" == "cost" ]
then
	$DIR/stoke_cost $@
elif [ "$SCMD" == "simulate" ]
then
	$DIR/stoke_simulate $@
elif [ "$SCMD" == "validate" ]
then
	$DIR/stoke_validate $@
else
	echo "Unknown command: '"$SCMD"'"
	echo "Type 'stoke_debug --help' for usage."
	exit 1
fi
